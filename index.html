<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proekt.top - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #000;
            color: #ffeb3b;
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background-color: #111;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ffeb3b;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #ffeb3b;
            cursor: pointer;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .auth-buttons button {
            background-color: #ffeb3b;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-role {
            background-color: #333;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .nav-back {
            background-color: #111;
            padding: 1rem 2rem;
            border-bottom: 1px solid #333;
            display: none;
        }

        .nav-back button {
            background-color: transparent;
            color: #ffeb3b;
            border: 1px solid #ffeb3b;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .page {
            display: none;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .join-project-container {
            background-color: #111;
            border: 2px solid #ffeb3b;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .code-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .code-input input {
            flex: 1;
            max-width: 200px;
            padding: 0.8rem;
            background-color: #111;
            border: 1px solid #ffeb3b;
            border-radius: 4px;
            color: #fff;
            font-size: 1.2rem;
            text-align: center;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .code-input button {
            background-color: #ffeb3b;
            color: #000;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .grid-item {
            background-color: #111;
            border: 2px solid #ffeb3b;
            border-radius: 12px;
            padding: 2rem;
            color: #ffeb3b;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
        }

        .grid-item:hover {
            background-color: #ffeb3b;
            color: #000;
            transform: translateY(-5px);
        }

        .item-content {
            text-align: center;
        }

        .item-content h3 {
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .calendar-container {
            background-color: #111;
            border: 2px solid #ffeb3b;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-navigation {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-navigation button {
            background-color: #ffeb3b;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            background-color: #222;
            border: 1px solid #333;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 80px;
        }

        .calendar-day:hover {
            background-color: #ffeb3b;
            color: #000;
        }

        .calendar-day.has-event {
            background-color: #333;
            border-color: #ffeb3b;
        }

        .calendar-day-header {
            background-color: #333;
            font-weight: bold;
            padding: 0.5rem;
            text-align: center;
        }

        .event-indicator {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: #ffeb3b;
            border-radius: 50%;
        }

        .project-board {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 1rem;
            min-height: 500px;
        }

        .status-column {
            background-color: #111;
            border: 1px solid #ffeb3b;
            border-radius: 8px;
            padding: 1rem;
            min-width: 280px;
            flex-shrink: 0;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .task {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
        }

        .task:hover {
            border-color: #ffeb3b;
        }

        .task.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .task-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .delete-task-btn {
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-container {
            background-color: #111;
            border: 2px solid #ffeb3b;
            border-radius: 12px;
            padding: 1rem;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #000;
            border-radius: 8px;
        }

        .message {
            background-color: #222;
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid #ffeb3b;
        }

        .chat-input {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.8rem;
            background-color: #111;
            border: 1px solid #ffeb3b;
            border-radius: 4px;
            color: #fff;
        }

        .chat-input button {
            background-color: #ffeb3b;
            color: #000;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .host-controls {
            background-color: #111;
            border: 2px solid #ffeb3b;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .control-section {
            margin-bottom: 2rem;
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .user-card {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-actions {
            display: flex;
            gap: 0.5rem;
        }

        .user-actions button {
            background-color: #ffeb3b;
            color: #000;
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .role-select {
            background-color: #333;
            color: #ffeb3b;
            border: 1px solid #ffeb3b;
            padding: 0.3rem;
            border-radius: 4px;
        }

        .project-code-display {
            background-color: #222;
            border: 1px solid #ffeb3b;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin: 1rem 0;
        }

        .project-code {
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 4px;
            color: #ffeb3b;
            margin: 1rem 0;
        }

        .status-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .status-item {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background-color: #000;
            margin: 10% auto;
            padding: 2rem;
            border: 2px solid #ffeb3b;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close {
            color: #ffeb3b;
            float: right;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .modal-content input, .modal-content select, .modal-content textarea {
            width: 100%;
            padding: 0.8rem;
            background-color: #111;
            border: 1px solid #ffeb3b;
            border-radius: 4px;
            color: #fff;
        }

        .modal-content button {
            width: 100%;
            padding: 0.8rem;
            background-color: #ffeb3b;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .message {
            margin-top: 1rem;
            text-align: center;
            min-height: 1.5rem;
        }

        .role-selection {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1rem 0;
        }

        .role-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: #111;
            border: 1px solid #333;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-option:hover {
            background-color: #222;
            border-color: #ffeb3b;
        }

        .role-option.selected {
            background-color: #1a1a1a;
            border-color: #ffeb3b;
        }

        .role-radio {
            margin-right: 1rem;
        }

        .sync-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ffeb3b;
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: none;
        }

        .add-task-btn {
            background-color: #ffeb3b;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 1rem;
        }

        .events-list {
            margin-top: 1rem;
        }

        .event-item {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .page {
                padding: 1rem;
            }
            
            .grid-container {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo" onclick="showPage('home')">Proekt.top</div>
        <div class="auth-section" id="authSection">
            <div class="auth-buttons">
                <button onclick="openRegisterModal()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <button onclick="openLoginModal()">–í–æ–π—Ç–∏</button>
            </div>
        </div>
    </header>

    <div class="nav-back" id="navBack">
        <button onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
    </div>

    <div class="sync-indicator" id="syncIndicator">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç -->
    <div id="join-project-page" class="page">
        <div class="join-project-container">
            <h2>üö™ –í–æ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ</p>
            <div class="code-input">
                <input type="text" id="projectCodeInput" placeholder="–ö–û–î –ü–†–û–ï–ö–¢–ê" maxlength="6" style="text-transform: uppercase;">
                <button onclick="joinProject()">–í–æ–π—Ç–∏</button>
            </div>
            <p id="joinProjectMessage" class="message"></p>
            <p style="margin-top: 2rem; opacity: 0.7;">
                –ù–µ—Ç –∫–æ–¥–∞? <a onclick="openRegisterModal()" style="color: #ffeb3b; cursor: pointer; text-decoration: underline;">—Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç</a>
            </p>
        </div>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="home-page" class="page">
        <div class="page-header">
            <h1>üöÄ –ú–æ–π –ø—Ä–æ–µ–∫—Ç</h1>
            <p id="projectWelcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏</p>
        </div>
        <div class="grid-container">
            <div class="grid-item" onclick="showPage('calendar')">
                <div class="item-content">
                    <h3>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
                    <p>–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ —Å–æ–±—ã—Ç–∏—è</p>
                </div>
            </div>

            <div class="grid-item" id="hostCabinetLink" style="display: none;" onclick="showPage('host-cabinet')">
                <div class="item-content">
                    <h3>üëë –ö–∞–±–∏–Ω–µ—Ç –•–æ—Å—Ç–∞</h3>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–æ–º</p>
                </div>
            </div>

            <div class="grid-item" onclick="showPage('project-board')">
                <div class="item-content">
                    <h3>üìã –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ—Å–∫–∞</h3>
                    <p>–î–æ—Å–∫–∞ –∑–∞–¥–∞—á –∏ —Å—Ç–∞—Ç—É—Å–æ–≤</p>
                </div>
            </div>

            <div class="grid-item" onclick="showPage('chat')">
                <div class="item-content">
                    <h3>üí¨ –ß–∞—Ç</h3>
                    <p>–û–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
    <div id="calendar-page" class="page">
        <div class="page-header">
            <h1>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</h1>
            <p>–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ —Å–æ–±—ã—Ç–∏—è</p>
        </div>
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="calendar-navigation">
                    <button onclick="changeMonth(-1)">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <h2 id="currentMonth">–ú–∞—Ä—Ç 2024</h2>
                    <button onclick="changeMonth(1)">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <button onclick="openCreateEventModal()" id="createEventBtn">+ –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ—Å–∫–∏ -->
    <div id="project-board-page" class="page">
        <div class="page-header">
            <h1>üìã –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ—Å–∫–∞</h1>
            <p>–î–æ—Å–∫–∞ –∑–∞–¥–∞—á –∏ —Å—Ç–∞—Ç—É—Å–æ–≤</p>
        </div>
        <div class="project-board" id="projectBoard"></div>
        <button onclick="openTaskModal()" class="add-task-btn" id="addTaskBtn">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞ -->
    <div id="chat-page" class="page">
        <div class="page-header">
            <h1>üí¨ –ß–∞—Ç</h1>
            <p>–û–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</p>
        </div>
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–±–∏–Ω–µ—Ç–∞ —Ö–æ—Å—Ç–∞ -->
    <div id="host-cabinet-page" class="page">
        <div class="page-header">
            <h1>üëë –ö–∞–±–∏–Ω–µ—Ç –•–æ—Å—Ç–∞</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–æ–º</p>
        </div>
        <div class="host-controls">
            <div class="control-section">
                <h3>–ö–æ–¥ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="project-code-display">
                    <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –∫–æ–¥–æ–º —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏:</p>
                    <div class="project-code" id="projectCodeDisplay">XXXXXX</div>
                    <p class="code-instructions">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –≤–≤–µ—Å—Ç–∏ —ç—Ç–æ—Ç –∫–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–í–æ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç"</p>
                </div>
            </div>
            
            <div class="control-section">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                <div class="user-list" id="userList"></div>
            </div>
            
            <div class="control-section">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–¥–∞—á</h3>
                <button onclick="openCreateStatusModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                <div class="status-list" id="statusList"></div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2>–í—Ö–æ–¥ –≤ Proekt.top</h2>
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" placeholder="–ü–æ—á—Ç–∞" required id="loginEmail">
                </div>
                <div class="form-group">
                    <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" required id="loginPassword">
                </div>
                <button type="submit">–í–æ–π—Ç–∏</button>
            </form>
            <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="switchToRegister()" style="color: #ffeb3b; cursor: pointer;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            <p id="loginMessage" class="message"></p>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRegisterModal()">&times;</span>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Proekt.top</h2>
            <form id="registerForm">
                <div class="form-group">
                    <input type="text" placeholder="–ò–º—è" required id="regName">
                </div>
                <div class="form-group">
                    <input type="email" placeholder="–ü–æ—á—Ç–∞" required id="regEmail">
                </div>
                <div class="form-group">
                    <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" required id="regPassword">
                </div>
                <div class="form-group">
                    <input type="password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required id="regConfirmPassword">
                </div>
                
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:</label>
                    <div class="role-selection">
                        <div class="role-option" onclick="selectRole('member')">
                            <input type="radio" name="role" value="member" class="role-radio" id="roleMember" checked>
                            <div>
                                <div style="font-weight: bold;">–£—á–∞—Å—Ç–Ω–∏–∫</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É</div>
                            </div>
                        </div>
                        <div class="role-option" onclick="selectRole('host')">
                            <input type="radio" name="role" value="host" class="role-radio" id="roleHost">
                            <div>
                                <div style="font-weight: bold;">–•–æ—Å—Ç</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">–°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
            <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="switchToLogin()" style="color: #ffeb3b; cursor: pointer;">–í–æ–π—Ç–∏</a></p>
            <p id="registerMessage" class="message"></p>
        </div>
    </div>

    <div id="createEventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateEventModal()">&times;</span>
            <h2>–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</h2>
            <form id="createEventForm">
                <div class="form-group">
                    <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è" required id="eventTitle">
                </div>
                <div class="form-group">
                    <textarea placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è" rows="3" id="eventDescription"></textarea>
                </div>
                <div class="form-group">
                    <input type="date" id="eventDate" required>
                </div>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
            </form>
        </div>
    </div>

    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTaskModal()">&times;</span>
            <h2>–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
            <form id="taskForm">
                <div class="form-group">
                    <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required id="taskTitle">
                </div>
                <div class="form-group">
                    <textarea placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" rows="3" id="taskDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞—Ç—É—Å:</label>
                    <select id="taskStatus" required>
                        <!-- –°—Ç–∞—Ç—É—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </select>
                </div>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
            </form>
        </div>
    </div>

    <div id="createStatusModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateStatusModal()">&times;</span>
            <h2>–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—É—Å</h2>
            <form id="createStatusForm">
                <div class="form-group">
                    <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞" required id="statusName">
                </div>
                <div class="form-group">
                    <label>–¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞:</label>
                    <input type="color" id="statusColor" value="#ffeb3b">
                </div>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            </form>
        </div>
    </div>

    <div id="eventDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEventDetailsModal()">&times;</span>
            <h2>–°–æ–±—ã—Ç–∏—è –¥–Ω—è</h2>
            <div id="eventDetailsContent">
                <!-- –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let projects = JSON.parse(localStorage.getItem('proekt_top_projects')) || {};
        let currentProjectId = localStorage.getItem('proekt_top_currentProjectId');
        let currentUser = JSON.parse(localStorage.getItem('proekt_top_currentUser')) || null;
        let currentDate = new Date();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initializeSync();
            updateUIForUser();
            
            // –û–ß–ò–°–¢–ö–ê –í–°–ï–• –°–¢–ê–†–´–• –î–ê–ù–ù–´–•
            clearOldProjectData();
            
            if (currentUser && currentProjectId) {
                updateAllInterfaces();
                showPage('home');
            } else if (currentUser && !currentProjectId) {
                showPage('join-project');
            } else {
                showPage('home');
            }

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('eventDate').value = today;

            setupEventListeners();
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞
        function clearOldProjectData() {
            if (currentProjectId && projects[currentProjectId]) {
                const project = projects[currentProjectId];
                
                // –û—á–∏—â–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏
                project.tasks = [];
                
                // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ)
                project.statuses = [
                    { name: '–ù–æ–≤—ã–µ', color: '#ffeb3b' },
                    { name: '–í —Ä–∞–±–æ—Ç–µ', color: '#2196F3' },
                    { name: '–ì–æ—Ç–æ–≤–æ', color: '#4CAF50' }
                ];
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                saveData();
                console.log('–í—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã –æ—á–∏—â–µ–Ω—ã!');
            }
        }

        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('createEventForm').addEventListener('submit', handleCreateEvent);
            document.getElementById('taskForm').addEventListener('submit', handleCreateTask);
            document.getElementById('createStatusForm').addEventListener('submit', handleCreateStatus);
            
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            document.getElementById('projectCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') joinProject();
            });
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        function initializeSync() {
            window.addEventListener('storage', function(e) {
                if (e.key === 'proekt_top_projects') {
                    showSyncIndicator();
                    const newProjects = JSON.parse(e.newValue);
                    projects = newProjects;
                    if (currentProjectId) {
                        updateAllInterfaces();
                    }
                    setTimeout(hideSyncIndicator, 500);
                }
            });
        }

        function showSyncIndicator() {
            document.getElementById('syncIndicator').style.display = 'block';
        }

        function hideSyncIndicator() {
            document.getElementById('syncIndicator').style.display = 'none';
        }

        function saveData() {
            localStorage.setItem('proekt_top_projects', JSON.stringify(projects));
            localStorage.setItem('proekt_top_currentUser', JSON.stringify(currentUser));
            if (currentProjectId) {
                localStorage.setItem('proekt_top_currentProjectId', currentProjectId);
            }
            window.dispatchEvent(new Event('storage'));
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById(`${pageId}-page`);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            const navBack = document.getElementById('navBack');
            if (pageId === 'home' || pageId === 'join-project') {
                navBack.style.display = 'none';
            } else {
                navBack.style.display = 'block';
            }

            updatePageData(pageId);
        }

        function updatePageData(pageId) {
            switch(pageId) {
                case 'calendar':
                    updateCalendar();
                    updateCalendarPermissions();
                    break;
                case 'project-board':
                    updateProjectBoard();
                    updateProjectBoardPermissions();
                    initDragAndDrop();
                    break;
                case 'chat':
                    updateChat();
                    break;
                case 'host-cabinet':
                    updateHostCabinet();
                    break;
                case 'home':
                    updateProjectWelcome();
                    break;
            }
        }

        function updateAllInterfaces() {
            updateUIForUser();
            updateCalendar();
            updateProjectBoard();
            updateChat();
            updateHostCabinet();
            updateProjectWelcome();
            updatePermissions();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
        function updatePermissions() {
            updateCalendarPermissions();
            updateProjectBoardPermissions();
        }

        function updateCalendarPermissions() {
            const createEventBtn = document.getElementById('createEventBtn');
            if (createEventBtn) {
                createEventBtn.style.display = canEditContent() ? 'block' : 'none';
            }
        }

        function updateProjectBoardPermissions() {
            const addTaskBtn = document.getElementById('addTaskBtn');
            if (addTaskBtn) {
                addTaskBtn.style.display = canEditContent() ? 'block' : 'none';
            }
        }

        function canEditContent() {
            return currentUser && (currentUser.role === 'host' || currentUser.role === 'moderator');
        }

        function canDeleteTasks() {
            return currentUser && (currentUser.role === 'host' || currentUser.role === 'moderator');
        }

        // –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
        function generateInviteCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function createNewProject(hostEmail, hostName) {
            const projectId = 'project_' + Date.now();
            const inviteCode = generateInviteCode();
            
            projects[projectId] = {
                id: projectId,
                name: `–ü—Ä–æ–µ–∫—Ç ${hostName}`,
                inviteCode: inviteCode,
                createdAt: new Date().toISOString(),
                users: {
                    [hostEmail]: {
                        email: hostEmail,
                        name: hostName,
                        role: 'host',
                        joinedAt: new Date().toISOString()
                    }
                },
                statuses: [
                    { name: '–ù–æ–≤—ã–µ', color: '#ffeb3b' },
                    { name: '–í —Ä–∞–±–æ—Ç–µ', color: '#2196F3' },
                    { name: '–ì–æ—Ç–æ–≤–æ', color: '#4CAF50' }
                ],
                events: [],
                tasks: [], // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á
                messages: []
            };
            
            currentProjectId = projectId;
            return projectId;
        }

        function joinProject() {
            const code = document.getElementById('projectCodeInput').value.trim().toUpperCase();
            const messageEl = document.getElementById('joinProjectMessage');
            
            if (!code) {
                showMessage(messageEl, '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞', 'error');
                return;
            }
            
            const projectEntry = Object.entries(projects).find(([id, project]) => project.inviteCode === code);
            
            if (projectEntry) {
                const [projectId, project] = projectEntry;
                
                if (!currentUser) {
                    showMessage(messageEl, '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                    openLoginModal();
                    return;
                }
                
                if (!project.users[currentUser.email]) {
                    project.users[currentUser.email] = {
                        email: currentUser.email,
                        name: currentUser.name,
                        role: 'member',
                        joinedAt: new Date().toISOString()
                    };
                }
                
                currentProjectId = projectId;
                currentUser.projectId = projectId;
                currentUser.role = project.users[currentUser.email].role;
                
                saveData();
                
                showMessage(messageEl, '–£—Å–ø–µ—à–Ω–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –ø—Ä–æ–µ–∫—Ç—É!', 'success');
                
                setTimeout(() => {
                    updateUIForUser();
                    updateAllInterfaces();
                    showPage('home');
                }, 1000);
                
            } else {
                showMessage(messageEl, '–ü—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            }
        }

        function getCurrentProject() {
            return projects[currentProjectId];
        }

        function showMessage(element, text, type) {
            element.textContent = text;
            element.style.color = type === 'success' ? '#4caf50' : '#ff5252';
        }

        // UI —Ñ—É–Ω–∫—Ü–∏–∏
        function updateUIForUser() {
            const authSection = document.getElementById('authSection');
            const hostCabinetLink = document.getElementById('hostCabinetLink');
            const project = getCurrentProject();
            
            if (currentUser && currentProjectId && project) {
                authSection.innerHTML = `
                    <div class="user-info">
                        <span>${currentUser.name}</span>
                        <span class="user-role">${getRoleName(currentUser.role)}</span>
                        <button onclick="logout()">–í—ã–π—Ç–∏</button>
                    </div>
                `;
                
                hostCabinetLink.style.display = currentUser.role === 'host' ? 'block' : 'none';
            } else {
                authSection.innerHTML = `
                    <div class="auth-buttons">
                        <button onclick="openRegisterModal()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                        <button onclick="openLoginModal()">–í–æ–π—Ç–∏</button>
                    </div>
                `;
                hostCabinetLink.style.display = 'none';
            }
        }

        function updateProjectWelcome() {
            const project = getCurrentProject();
            const welcomeEl = document.getElementById('projectWelcome');
            if (project) {
                welcomeEl.textContent = `–ü—Ä–æ–µ–∫—Ç: ${project.name} | –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${Object.keys(project.users).length}`;
            } else {
                welcomeEl.textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏';
            }
        }

        function getRoleName(role) {
            const roleNames = {
                'host': 'üëë –•–æ—Å—Ç',
                'moderator': '‚ö° –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
                'member': 'üë• –£—á–∞—Å—Ç–Ω–∏–∫'
            };
            return roleNames[role] || role;
        }

        function logout() {
            currentUser = null;
            currentProjectId = null;
            updateUIForUser();
            saveData();
            showPage('home');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏
        function selectRole(role) {
            document.querySelectorAll('.role-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            const selectedOption = document.querySelector(`.role-option input[value="${role}"]`).parentElement;
            selectedOption.classList.add('selected');
            
            document.querySelectorAll('.role-radio').forEach(radio => {
                radio.checked = radio.value === role;
            });
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openLoginModal() { 
            closeRegisterModal(); 
            document.getElementById('loginModal').style.display = 'block'; 
        }

        function closeLoginModal() { 
            document.getElementById('loginModal').style.display = 'none'; 
            document.getElementById('loginForm').reset();
            document.getElementById('loginMessage').textContent = '';
        }

        function openRegisterModal() { 
            closeLoginModal(); 
            document.getElementById('registerModal').style.display = 'block'; 
            selectRole('member');
        }

        function closeRegisterModal() { 
            document.getElementById('registerModal').style.display = 'none'; 
            document.getElementById('registerForm').reset();
            document.getElementById('registerMessage').textContent = '';
        }

        function openCreateEventModal() { 
            if (!canEditContent()) {
                alert('–¢–æ–ª—å–∫–æ —Ö–æ—Å—Ç –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è');
                return;
            }
            document.getElementById('createEventModal').style.display = 'block'; 
        }

        function closeCreateEventModal() { 
            document.getElementById('createEventModal').style.display = 'none'; 
        }

        function openTaskModal() { 
            if (!canEditContent()) {
                alert('–¢–æ–ª—å–∫–æ —Ö–æ—Å—Ç –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏');
                return;
            }
            updateTaskStatusSelect();
            document.getElementById('taskModal').style.display = 'block'; 
        }

        function closeTaskModal() { 
            document.getElementById('taskModal').style.display = 'none'; 
        }

        function openCreateStatusModal() { 
            document.getElementById('createStatusModal').style.display = 'block'; 
        }

        function closeCreateStatusModal() { 
            document.getElementById('createStatusModal').style.display = 'none'; 
        }

        function openEventDetailsModal(day) {
            showEventDetails(day);
            document.getElementById('eventDetailsModal').style.display = 'block';
        }

        function closeEventDetailsModal() {
            document.getElementById('eventDetailsModal').style.display = 'none';
        }

        function switchToRegister() { 
            closeLoginModal(); 
            openRegisterModal(); 
        }

        function switchToLogin() { 
            closeRegisterModal(); 
            openLoginModal(); 
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const messageEl = document.getElementById('loginMessage');
            
            if (!email || !password) {
                showMessage(messageEl, '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            let userFound = false;
            let userRole = 'member';
            let userProjectId = null;
            
            for (const [projectId, project] of Object.entries(projects)) {
                if (project.users[email]) {
                    userFound = true;
                    userRole = project.users[email].role;
                    userProjectId = projectId;
                    break;
                }
            }
            
            if (userFound) {
                currentUser = { 
                    email: email, 
                    name: email.split('@')[0],
                    role: userRole,
                    projectId: userProjectId
                };
                currentProjectId = userProjectId;
                
                showMessage(messageEl, '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', 'success');
                
                setTimeout(() => {
                    updateUIForUser();
                    saveData();
                    closeLoginModal();
                    updateAllInterfaces();
                    showPage('home');
                }, 1000);
            } else {
                currentUser = { 
                    email: email, 
                    name: email.split('@')[0],
                    role: 'member'
                };
                
                showMessage(messageEl, '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç.', 'success');
                
                setTimeout(() => {
                    updateUIForUser();
                    saveData();
                    closeLoginModal();
                    showPage('join-project');
                }, 1000);
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const role = document.querySelector('input[name="role"]:checked').value;
            const messageEl = document.getElementById('registerMessage');
            
            if (!name || !email || !password || !confirmPassword) {
                showMessage(messageEl, '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage(messageEl, '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!', 'error');
                return;
            }
            
            if (role === 'host') {
                createNewProject(email, name);
                currentUser = { 
                    email: email, 
                    name: name,
                    role: 'host'
                };
                
                showMessage(messageEl, '–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...', 'success');
                
                setTimeout(() => {
                    updateUIForUser();
                    saveData();
                    closeRegisterModal();
                    updateAllInterfaces();
                    showPage('home');
                }, 1500);
                
            } else {
                currentUser = { 
                    email: email, 
                    name: name,
                    role: 'member'
                };
                
                showMessage(messageEl, '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                
                setTimeout(() => {
                    updateUIForUser();
                    saveData();
                    closeRegisterModal();
                    showPage('join-project');
                }, 1500);
            }
        }

        function handleCreateEvent(e) {
            e.preventDefault();
            const project = getCurrentProject();
            const title = document.getElementById('eventTitle').value;
            const description = document.getElementById('eventDescription').value;
            const date = document.getElementById('eventDate').value;
            
            if (!title || !date) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            project.events.push({
                id: 'event_' + Date.now(),
                title: title,
                description: description,
                date: date,
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            });
            
            saveData();
            updateCalendar();
            closeCreateEventModal();
            alert('–°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
        }

        function handleCreateTask(e) {
            e.preventDefault();
            const project = getCurrentProject();
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const status = document.getElementById('taskStatus').value;
            
            if (!title || !status) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            project.tasks.push({
                id: 'task_' + Date.now(),
                title: title,
                description: description,
                status: status,
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            });
            
            saveData();
            updateProjectBoard();
            initDragAndDrop();
            closeTaskModal();
            alert('–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞!');
        }

        function handleCreateStatus(e) {
            e.preventDefault();
            const project = getCurrentProject();
            const name = document.getElementById('statusName').value;
            const color = document.getElementById('statusColor').value;
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞');
                return;
            }
            
            if (project.statuses.some(status => status.name === name)) {
                alert('–°—Ç–∞—Ç—É—Å —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            project.statuses.push({
                name: name,
                color: color
            });
            
            saveData();
            updateHostCabinet();
            updateProjectBoard();
            initDragAndDrop();
            closeCreateStatusModal();
            alert('–°—Ç–∞—Ç—É—Å —Å–æ–∑–¥–∞–Ω!');
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
        function updateCalendar() {
            const project = getCurrentProject();
            if (!project) return;
            
            const events = project.events || [];
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
            document.getElementById('currentMonth').textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            for (let i = 0; i < (firstDay.getDay() + 6) % 7; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dayEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getDate() === day && 
                           eventDate.getMonth() === currentDate.getMonth() && 
                           eventDate.getFullYear() === currentDate.getFullYear();
                });
                
                if (dayEvents.length > 0) {
                    dayElement.classList.add('has-event');
                    
                    const eventIndicator = document.createElement('div');
                    eventIndicator.className = 'event-indicator';
                    dayElement.appendChild(eventIndicator);
                }
                
                dayElement.onclick = () => openEventDetailsModal(day);
                calendarGrid.appendChild(dayElement);
            }
        }

        function showEventDetails(day) {
            const project = getCurrentProject();
            if (!project) return;
            
            const events = project.events || [];
            const users = project.users || {};
            const eventDetailsContent = document.getElementById('eventDetailsContent');
            
            const dayEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getDate() === day && 
                       eventDate.getMonth() === currentDate.getMonth() && 
                       eventDate.getFullYear() === currentDate.getFullYear();
            });
            
            if (dayEvents.length === 0) {
                eventDetailsContent.innerHTML = '<p>–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π</p>';
            } else {
                let eventsHTML = '<div class="events-list">';
                dayEvents.forEach(event => {
                    const user = users[event.createdBy];
                    eventsHTML += `
                        <div class="event-item">
                            <h4>${event.title}</h4>
                            <p>${event.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                            <small>–°–æ–∑–¥–∞–ª: ${user?.name || event.createdBy}</small>
                        </div>
                    `;
                });
                eventsHTML += '</div>';
                eventDetailsContent.innerHTML = eventsHTML;
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateCalendar();
        }

        // –ß–∞—Ç
        function updateChat() {
            const project = getCurrentProject();
            if (!project) return;
            
            const messages = project.messages || [];
            const users = project.users || {};
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            
            if (messages.length === 0) {
                const welcomeMessage = document.createElement('div');
                welcomeMessage.className = 'message';
                welcomeMessage.innerHTML = `
                    <div class="message-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±—â–∏–π —á–∞—Ç –ø—Ä–æ–µ–∫—Ç–∞! –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ.</div>
                `;
                messagesContainer.appendChild(welcomeMessage);
            } else {
                messages.forEach(msg => {
                    const user = users[msg.userEmail];
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message';
                    messageDiv.innerHTML = `
                        <div class="message-text">
                            <strong>${user?.name || msg.userEmail}:</strong> ${msg.text}
                        </div>
                    `;
                    messagesContainer.appendChild(messageDiv);
                });
            }
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (text === '' || !currentUser || !currentProjectId) return;
            
            const project = getCurrentProject();
            if (!project.messages) project.messages = [];
            
            project.messages.push({
                userEmail: currentUser.email,
                text: text,
                timestamp: new Date().toISOString()
            });
            
            saveData();
            updateChat();
            input.value = '';
        }

        // –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ—Å–∫–∞ —Å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º –∏ —É–¥–∞–ª–µ–Ω–∏–µ–º –∑–∞–¥–∞—á
        function updateProjectBoard() {
            const project = getCurrentProject();
            if (!project) return;
            
            const statuses = project.statuses || [];
            const tasks = project.tasks || [];
            const projectBoard = document.getElementById('projectBoard');
            projectBoard.innerHTML = '';
            
            statuses.forEach(status => {
                const statusColumn = document.createElement('div');
                statusColumn.className = 'status-column';
                statusColumn.style.borderColor = status.color;
                statusColumn.dataset.status = status.name;
                
                const statusHeader = document.createElement('div');
                statusHeader.className = 'status-header';
                statusHeader.innerHTML = `<h3 style="color: ${status.color}">${status.name}</h3>`;
                
                statusColumn.appendChild(statusHeader);
                
                const statusTasks = tasks.filter(task => task.status === status.name);
                statusTasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = 'task';
                    taskElement.draggable = canEditContent();
                    taskElement.dataset.taskId = task.id;
                    taskElement.innerHTML = `
                        ${canDeleteTasks() ? `
                            <div class="task-actions">
                                <button class="delete-task-btn" onclick="deleteTask('${task.id}')">√ó</button>
                            </div>
                        ` : ''}
                        <h4>${task.title}</h4>
                        <p>${task.description || ''}</p>
                        <small>–°–æ–∑–¥–∞–Ω–æ: ${new Date(task.createdAt).toLocaleDateString()}</small>
                    `;
                    statusColumn.appendChild(taskElement);
                });
                
                projectBoard.appendChild(statusColumn);
            });
        }

        function deleteTask(taskId) {
            if (!canDeleteTasks()) {
                alert('–¢–æ–ª—å–∫–æ —Ö–æ—Å—Ç –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞—á–∏');
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) {
                const project = getCurrentProject();
                if (project) {
                    project.tasks = project.tasks.filter(task => task.id !== taskId);
                    saveData();
                    updateProjectBoard();
                    initDragAndDrop();
                    alert('–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞!');
                }
            }
        }

        function initDragAndDrop() {
            const tasks = document.querySelectorAll('.task');
            const columns = document.querySelectorAll('.status-column');
            
            tasks.forEach(task => {
                task.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', task.dataset.taskId);
                    task.classList.add('dragging');
                });
                
                task.addEventListener('dragend', () => {
                    task.classList.remove('dragging');
                });
            });
            
            columns.forEach(column => {
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    column.style.backgroundColor = 'rgba(255, 235, 59, 0.1)';
                });
                
                column.addEventListener('dragleave', () => {
                    column.style.backgroundColor = '';
                });
                
                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    column.style.backgroundColor = '';
                    const taskId = e.dataTransfer.getData('text/plain');
                    const newStatus = column.dataset.status;
                    
                    if (taskId && newStatus) {
                        const project = getCurrentProject();
                        const task = project.tasks.find(t => t.id === taskId);
                        if (task) {
                            task.status = newStatus;
                            task.lastMoved = new Date().toISOString();
                            task.movedBy = currentUser.email;
                            
                            saveData();
                            updateProjectBoard();
                            initDragAndDrop();
                        }
                    }
                });
            });
        }

        function updateTaskStatusSelect() {
            const project = getCurrentProject();
            if (!project) return;
            
            const statusSelect = document.getElementById('taskStatus');
            statusSelect.innerHTML = '';
            
            project.statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status.name;
                option.textContent = status.name;
                statusSelect.appendChild(option);
            });
        }

        // –ö–∞–±–∏–Ω–µ—Ç —Ö–æ—Å—Ç–∞
        function updateHostCabinet() {
            updateUserList();
            updateProjectCode();
            updateStatusList();
        }

        function updateUserList() {
            const project = getCurrentProject();
            if (!project) return;
            
            const users = project.users || {};
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            
            Object.entries(users).forEach(([email, user]) => {
                if (user.role !== 'host') {
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.innerHTML = `
                        <div>
                            <strong>${user.name}</strong> (${email})
                            <br>
                            <small>–†–æ–ª—å: ${getRoleName(user.role)}</small>
                        </div>
                        <div class="user-actions">
                            <select class="role-select" onchange="changeUserRole('${email}', this.value)">
                                <option value="member" ${user.role === 'member' ? 'selected' : ''}>–£—á–∞—Å—Ç–Ω–∏–∫</option>
                                <option value="moderator" ${user.role === 'moderator' ? 'selected' : ''}>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                            </select>
                            <button onclick="removeUser('${email}')">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                    userList.appendChild(userCard);
                }
            });
        }

        function updateStatusList() {
            const project = getCurrentProject();
            if (!project) return;
            
            const statuses = project.statuses || [];
            const statusList = document.getElementById('statusList');
            statusList.innerHTML = '';
            
            statuses.forEach((status, index) => {
                const statusItem = document.createElement('div');
                statusItem.className = 'status-item';
                statusItem.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div class="status-color" style="background-color: ${status.color}"></div>
                        <strong>${status.name}</strong>
                    </div>
                    <button onclick="removeStatus(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                statusList.appendChild(statusItem);
            });
        }

        function updateProjectCode() {
            const project = getCurrentProject();
            if (project && project.inviteCode) {
                document.getElementById('projectCodeDisplay').textContent = project.inviteCode;
            }
        }

        function changeUserRole(email, newRole) {
            const project = getCurrentProject();
            if (project && project.users[email]) {
                project.users[email].role = newRole;
                
                if (currentUser && currentUser.email === email) {
                    currentUser.role = newRole;
                    updateUIForUser();
                    updatePermissions();
                    updateProjectBoard();
                    initDragAndDrop();
                }
                
                saveData();
                updateHostCabinet();
                alert(`–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${email} –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ "${getRoleName(newRole)}"`);
            }
        }

        function removeUser(email) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${email} –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞?`)) {
                const project = getCurrentProject();
                if (project && project.users[email]) {
                    delete project.users[email];
                    saveData();
                    updateHostCabinet();
                    
                    if (currentUser && currentUser.email === email) {
                        logout();
                    }
                    
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞');
                }
            }
        }

        function removeStatus(index) {
            const project = getCurrentProject();
            if (project && project.statuses[index]) {
                const statusName = project.statuses[index].name;
                
                const tasksWithStatus = project.tasks.filter(task => task.status === statusName);
                if (tasksWithStatus.length > 0) {
                    alert(`–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—É—Å "${statusName}", —Ç–∞–∫ –∫–∞–∫ —Å –Ω–∏–º —Å–≤—è–∑–∞–Ω—ã –∑–∞–¥–∞—á–∏. –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –∑–∞–¥–∞—á–∏ –≤ –¥—Ä—É–≥–∏–µ —Å—Ç–∞—Ç—É—Å—ã.`);
                    return;
                }
                
                if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—É—Å "${statusName}"?`)) {
                    project.statuses.splice(index, 1);
                    saveData();
                    updateHostCabinet();
                    updateProjectBoard();
                    initDragAndDrop();
                    alert('–°—Ç–∞—Ç—É—Å —É–¥–∞–ª–µ–Ω');
                }
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            const modals = ['loginModal', 'registerModal', 'createEventModal', 'taskModal', 'createStatusModal', 'eventDetailsModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    if (modalId === 'loginModal') closeLoginModal();
                    if (modalId === 'registerModal') closeRegisterModal();
                    if (modalId === 'createEventModal') closeCreateEventModal();
                    if (modalId === 'taskModal') closeTaskModal();
                    if (modalId === 'createStatusModal') closeCreateStatusModal();
                    if (modalId === 'eventDetailsModal') closeEventDetailsModal();
                }
            });
        }
    </script>
</body>
</html>
